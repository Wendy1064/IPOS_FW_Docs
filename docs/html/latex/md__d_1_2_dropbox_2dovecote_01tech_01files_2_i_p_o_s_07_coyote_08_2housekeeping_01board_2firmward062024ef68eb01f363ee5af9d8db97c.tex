\chapter{IPOS ↔ Anybus M40 Variable Map}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c}{}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c}\index{IPOS ↔ Anybus M40 Variable Map@{IPOS ↔ Anybus M40 Variable Map}}
\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md244}%
\Hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md244}%
This document describes the Profinet variable interface implemented in the {\bfseries{IPOS Anybus M40 firmware}}. ~\newline
 It defines how status, input, and output data are exchanged between\+:


\begin{DoxyItemize}
\item {\bfseries{STM32 Master (Housekeeping Board)}}
\item {\bfseries{Anybus M40 Module}}
\item {\bfseries{Profinet PLC}}
\end{DoxyItemize}

\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md246}{}\doxysection{\texorpdfstring{1. Overview}{1. Overview}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md246}
The M40 firmware extends the standard HMS application to expose a set of custom process-\/data variables over the Profinet bus. ~\newline
 The STM32 master communicates with the M40 through {\bfseries{UART 3}}, using a lightweight 16-\/bit variable protocol. ~\newline
 Each variable corresponds to a register in the Anybus Object Dictionary and is updated cyclically (\texorpdfstring{$\sim$}{\string~}50 ms).

\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md248}{}\doxysection{\texorpdfstring{2. Communication Flow}{2. Communication Flow}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md248}

\begin{DoxyCode}{0}
\DoxyCodeLine{PLC\ ⇄\ Profinet\ ⇄\ Anybus\ M40\ ⇄\ UART3\ ⇄\ STM32\ Master}
\DoxyCodeLine{|\ |\ |}
\DoxyCodeLine{|\ |\ ├──\ Reads/Writes\ PORTA/B/C}
\DoxyCodeLine{|\ └──\ Maps\ variables\ into\ OD\ (VAR\_xx)}
\DoxyCodeLine{└──\ Reads\ STATUS\ and\ drives\ control\ bits}

\end{DoxyCode}


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md250}{}\doxysection{\texorpdfstring{3. Process-\/\+Data Variables}{3. Process-\/\+Data Variables}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md250}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{5}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Variable ID   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Symbol Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Direction   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit-\/\+Width   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-5}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Variable ID   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Symbol Name   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Direction   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit-\/\+Width   }&\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-5}
\endhead
{\ttfamily 0x200}   &{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+PLC}   &Input (M40 → PLC)   &16 bit   &Status word received from PLC via Profinet input area. Bit 0 = Reset Latches pulse; Bit 1 = Force Error.    \\\cline{1-5}
{\ttfamily 0x201}   &{\ttfamily VAR\+\_\+\+PORTA\+\_\+\+OUT}   &Output (PLC → M40)   &16 bit   &Digital outputs (PORTA) set by PLC; relayed to STM32.    \\\cline{1-5}
{\ttfamily 0x202}   &{\ttfamily VAR\+\_\+\+PORTB\+\_\+\+OUT}   &Output (PLC → M40)   &16 bit   &Digital outputs (PORTB) set by PLC; 10 bits used.    \\\cline{1-5}
{\ttfamily 0x203}   &{\ttfamily VAR\+\_\+\+PORTC\+\_\+\+IN}   &Input (M40 → PLC)   &16 bit   &Input snapshot from STM32 PORTC. Updated cyclically.    \\\cline{1-5}
{\ttfamily 0x204}   &{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+DEBUG}   &Input (M40 → PLC)   &16 bit   &Diagnostic flags and system status bits for debugging.   \\\cline{1-5}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md252}{}\doxysection{\texorpdfstring{4. Bit-\/\+Field Definitions}{4. Bit-\/\+Field Definitions}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md252}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md253}{}\doxysubsection{\texorpdfstring{{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+PLC} (0x200) — PLC → STM32}{{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+PLC} (0x200) — PLC → STM32}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md253}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit   }&\cellcolor{\tableheadbgcolor}\textbf{ Symbol   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit   }&\cellcolor{\tableheadbgcolor}\textbf{ Symbol   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endhead
\PBS\centering 0   &{\ttfamily RESET\+\_\+\+LATCHES}   &Pulse high to reset safety latches on STM32 (master acknowledges).    \\\cline{1-3}
\PBS\centering 1   &{\ttfamily FORCE\+\_\+\+LATCH\+\_\+\+ERROR}   &Simulates a fault condition for testing.    \\\cline{1-3}
\PBS\centering 2   &{\ttfamily ENABLE\+\_\+\+OUTPUTS}   &Allow relay/\+IO activation after startup.    \\\cline{1-3}
\PBS\centering 3   &{\ttfamily CLEAR\+\_\+\+LOGS}   &Clears non-\/volatile event log.    \\\cline{1-3}
\PBS\centering 15 .. 4   &—   &Reserved for future use.   \\\cline{1-3}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md255}{}\doxysubsection{\texorpdfstring{{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+DEBUG} (0x204) — STM32 → PLC}{{\ttfamily VAR\+\_\+\+STATUS\+\_\+\+DEBUG} (0x204) — STM32 → PLC}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md255}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit   }&\cellcolor{\tableheadbgcolor}\textbf{ Symbol   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\PBS\centering \cellcolor{\tableheadbgcolor}\textbf{ Bit   }&\cellcolor{\tableheadbgcolor}\textbf{ Symbol   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endhead
\PBS\centering 0   &{\ttfamily SYS\+\_\+\+READY}   &Firmware ready / all tasks running.    \\\cline{1-3}
\PBS\centering 1   &{\ttfamily THERMO\+\_\+\+FAULT}   &Thermocouple error detected.    \\\cline{1-3}
\PBS\centering 2   &{\ttfamily RELAY\+\_\+\+FAULT}   &Relay state mismatch.    \\\cline{1-3}
\PBS\centering 3   &{\ttfamily WATCHDOG}   &Watchdog event triggered since last reset.    \\\cline{1-3}
\PBS\centering 4   &{\ttfamily LATCH\+\_\+\+FAULT}   &Latch hardware fault latched.    \\\cline{1-3}
\PBS\centering 5   &{\ttfamily USB\+\_\+\+ACTIVE}   &USB logging task active.    \\\cline{1-3}
\PBS\centering 6   &{\ttfamily PLC\+\_\+\+ONLINE}   &Profinet link established.    \\\cline{1-3}
\PBS\centering 7   &{\ttfamily DEBUG\+\_\+\+VERBOSE}   &Verbose USB debug enabled.    \\\cline{1-3}
\PBS\centering 15 .. 8   &—   &Reserved for future diagnostics.   \\\cline{1-3}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md257}{}\doxysection{\texorpdfstring{5. UART Link Frame Format}{5. UART Link Frame Format}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md257}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{3}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Field   }&\cellcolor{\tableheadbgcolor}\textbf{ Size   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Field   }&\cellcolor{\tableheadbgcolor}\textbf{ Size   }&\cellcolor{\tableheadbgcolor}\textbf{ Description    }\\\cline{1-3}
\endhead
Header   &1 B   &0x\+AA start byte    \\\cline{1-3}
Var ID   &1 B   &Low-\/byte of variable index (0x00–0x\+FF)    \\\cline{1-3}
Value   &2 B   &Little-\/endian 16-\/bit data    \\\cline{1-3}
CRC   &1 B   &XOR of previous bytes   \\\cline{1-3}
\end{longtabu}


{\bfseries{Example}} – Write {\ttfamily PORTA = 0x1234} ~\newline
 → {\ttfamily AA 01 34 12 9F} ~\newline


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md259}{}\doxysection{\texorpdfstring{6. Profinet Object Dictionary Mapping}{6. Profinet Object Dictionary Mapping}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md259}
\tabulinesep=1mm
\begin{longtabu}spread 0pt [c]{*{6}{|X[-1]}|}
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Index (hex)   }&\cellcolor{\tableheadbgcolor}\textbf{ Name   }&\cellcolor{\tableheadbgcolor}\textbf{ Object Type   }&\cellcolor{\tableheadbgcolor}\textbf{ Direction   }&\cellcolor{\tableheadbgcolor}\textbf{ Size   }&\cellcolor{\tableheadbgcolor}\textbf{ Comment    }\\\cline{1-6}
\endfirsthead
\hline
\endfoot
\hline
\cellcolor{\tableheadbgcolor}\textbf{ Index (hex)   }&\cellcolor{\tableheadbgcolor}\textbf{ Name   }&\cellcolor{\tableheadbgcolor}\textbf{ Object Type   }&\cellcolor{\tableheadbgcolor}\textbf{ Direction   }&\cellcolor{\tableheadbgcolor}\textbf{ Size   }&\cellcolor{\tableheadbgcolor}\textbf{ Comment    }\\\cline{1-6}
\endhead
{\ttfamily 0x3000}   &{\ttfamily IPOS\+\_\+\+Status}   &Process Object   &IN   &2 bytes   &Mapped to {\ttfamily VAR\+\_\+\+STATUS\+\_\+\+DEBUG}    \\\cline{1-6}
{\ttfamily 0x3001}   &{\ttfamily Port\+C\+\_\+\+Inputs}   &Process Object   &IN   &2 bytes   &Mapped to {\ttfamily VAR\+\_\+\+PORTC\+\_\+\+IN}    \\\cline{1-6}
{\ttfamily 0x3002}   &{\ttfamily Port\+A\+\_\+\+Outputs}   &Process Object   &OUT   &2 bytes   &Mapped to {\ttfamily VAR\+\_\+\+PORTA\+\_\+\+OUT}    \\\cline{1-6}
{\ttfamily 0x3003}   &{\ttfamily Port\+B\+\_\+\+Outputs}   &Process Object   &OUT   &2 bytes   &Mapped to {\ttfamily VAR\+\_\+\+PORTB\+\_\+\+OUT}    \\\cline{1-6}
{\ttfamily 0x3004}   &{\ttfamily PLC\+\_\+\+Control}   &Process Object   &OUT   &2 bytes   &Mapped to {\ttfamily VAR\+\_\+\+STATUS\+\_\+\+PLC}   \\\cline{1-6}
\end{longtabu}


\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md261}{}\doxysection{\texorpdfstring{7. Timing and Synchronization}{7. Timing and Synchronization}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md261}

\begin{DoxyItemize}
\item UART update period ≈ 50 ms (default)
\item Profinet I/O cycle time 1–4 ms (configurable)
\item Each M40 update cycles through all variables\+:
\begin{DoxyEnumerate}
\item Read incoming PLC outputs ~\newline

\item Forward to STM32 via UART3 ~\newline

\item Read STM32 inputs and status ~\newline

\item Update Profinet input area
\end{DoxyEnumerate}
\end{DoxyItemize}

\DoxyHorRuler{0}
\hypertarget{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md263}{}\doxysection{\texorpdfstring{8. Debug and Diagnostics}{8. Debug and Diagnostics}}\label{md__d_1_2_dropbox_2dovecote_01tech_01files_2_i_p_o_s_07_coyote_08_2housekeeping_01board_2firmward062024ef68eb01f363ee5af9d8db97c_autotoc_md263}
Enable USB logging on the STM32 to trace link activity\+:


\begin{DoxyCode}{0}
\DoxyCodeLine{\mbox{\hyperlink{group__protocol_gaf2833787d9240d7acbb8e759d6cf775a}{UsbPrintf}}(\textcolor{stringliteral}{"{}DATA:\ STATUS\_PLC\ =\ \%04X,\ PORTA=\%04X,\ PORTC=\%04X\(\backslash\)r\(\backslash\)n"{}},}
\DoxyCodeLine{\ \ \ \ \ \ \ \ \ \ \ status\_plc,\ portA\_out,\ portC\_in);}

\end{DoxyCode}
 