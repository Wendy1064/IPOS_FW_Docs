\doxysection{log\+\_\+flash.\+h File Reference}
\hypertarget{log__flash_8h}{}\label{log__flash_8h}\index{log\_flash.h@{log\_flash.h}}


Public API for flash-\/based logging of system events and errors.  


{\ttfamily \#include $<$stdint.\+h$>$}\newline
{\ttfamily \#include $<$stddef.\+h$>$}\newline
{\ttfamily \#include "{}main.\+h"{}}\newline
{\ttfamily \#include "{}cmsis\+\_\+os2.\+h"{}}\newline
Include dependency graph for log\+\_\+flash.\+h\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{log__flash_8h__incl}
\end{center}
\end{figure}
This graph shows which files directly or indirectly include this file\+:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{log__flash_8h__dep__incl}
\end{center}
\end{figure}
\doxysubsubsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \mbox{\hyperlink{struct_log_msg__t}{Log\+Msg\+\_\+t}}
\begin{DoxyCompactList}\small\item\em Log message structure for queued events. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Macros}
\begin{Indent}\textbf{ Flash log layout configuration}\par
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{group__log__flash_gacdd7c55a0924d6deca8d60fa4c46af20}{LOG\+\_\+\+BASE}}~0x000000
\item 
\#define \mbox{\hyperlink{group__log__flash_gaa3d18ef8bebba9252ee656ca4db2eba4}{LOG\+\_\+\+SECTORS}}~2
\item 
\#define \mbox{\hyperlink{group__log__flash_gaa35bad1e92008da628f27b2f6bb270aa}{SECTOR\+\_\+\+SIZE}}~4096
\item 
\#define \mbox{\hyperlink{group__log__flash_gaf2626f3f54ad88732c3309a5c0c01760}{REC\+\_\+\+SIZE}}~sizeof(\mbox{\hyperlink{group__log__flash_gaa8e473f8371172fa02b2ecf3bf4b2010}{Log\+Rec}})
\item 
\#define \mbox{\hyperlink{group__log__flash_gadb2ca259a26eb6fff68cba2fe15a38ca}{RECS\+\_\+\+PER\+\_\+\+SECTOR}}~(\mbox{\hyperlink{group__log__flash_gaa35bad1e92008da628f27b2f6bb270aa}{SECTOR\+\_\+\+SIZE}} / \mbox{\hyperlink{group__log__flash_gaf2626f3f54ad88732c3309a5c0c01760}{REC\+\_\+\+SIZE}})
\item 
\#define \mbox{\hyperlink{group__log__flash_ga3e6daaec7e3afbd03bd78beaab01d0b9}{LOG\+\_\+\+CAPACITY}}~(\mbox{\hyperlink{group__log__flash_gaa3d18ef8bebba9252ee656ca4db2eba4}{LOG\+\_\+\+SECTORS}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{group__log__flash_gadb2ca259a26eb6fff68cba2fe15a38ca}{RECS\+\_\+\+PER\+\_\+\+SECTOR}})
\item 
\#define \mbox{\hyperlink{group__log__flash_ga1d5f5afa4da8aae64bc415c5596fab41}{COMMIT\+\_\+\+VAL}}~0x7E
\end{DoxyCompactItemize}
\end{Indent}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \mbox{\hyperlink{group__log__flash_ga5f3b99e0966ad05cc569bea9b503b148}{Log\+\_\+\+Init}} (void)
\begin{DoxyCompactList}\small\item\em Message structure used for asynchronous logging via RTOS queue. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__log__flash_ga9a06f8947190ea69e5f7f6748a957855}{Log\+\_\+\+Erase\+All}} (void)
\item 
struct \mbox{\hyperlink{group__log__flash_gab898071398b359603a35c202e9c65f3b}{\+\_\+\+\_\+attribute\+\_\+\+\_\+}} ((packed))
\begin{DoxyCompactList}\small\item\em Represents a single flash log record. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__log__flash_gaf7be7be3d5aa3ad8ce8eb8f080d34baa}{Log\+\_\+\+Append}} (uint16\+\_\+t code, uint16\+\_\+t flags, const char \texorpdfstring{$\ast$}{*}msg)
\begin{DoxyCompactList}\small\item\em Append a new record to the flash log. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__log__flash_ga661cd6aecf9a843941229e9789ef8d8f}{Log\+\_\+\+Read\+LastN}} (uint32\+\_\+t n, \mbox{\hyperlink{group__log__flash_gaa8e473f8371172fa02b2ecf3bf4b2010}{Log\+Rec}} \texorpdfstring{$\ast$}{*}out, uint32\+\_\+t max\+\_\+out)
\begin{DoxyCompactList}\small\item\em Read the last {\ttfamily n} records from flash. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{group__log__flash_ga68cbde1bd242d16f0c97aa1a6a982674}{Log\+\_\+\+Count\+Valid}} (void)
\begin{DoxyCompactList}\small\item\em Count the number of valid (committed) records currently stored. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{group__log__flash_gae4a37f521a0098079c9f62bb1014569f}{v\+Task\+Log\+Writer}} (void \texorpdfstring{$\ast$}{*}argument)
\begin{DoxyCompactList}\small\item\em Free\+RTOS task responsible for writing queued log messages to flash. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{group__log__flash_gab44417e89973f9f0c7b2d0aaa7ba25ac}{Log\+\_\+\+Get\+Write\+Index}} (void)
\begin{DoxyCompactList}\small\item\em Get the current write index within the circular buffer. \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{group__log__flash_ga2d734e69f4ea869029a8bb750d24540d}{Log\+\_\+\+Get\+Sequence\+Next}} (void)
\begin{DoxyCompactList}\small\item\em Get the next sequential record number to be assigned. \end{DoxyCompactList}\end{DoxyCompactItemize}
\doxysubsubsection*{Variables}
\begin{DoxyCompactItemize}
\item 
uint32\+\_\+t \mbox{\hyperlink{group__log__flash_ga2e3467bd12b4bc5a03d2ef75df455976}{wr\+\_\+index}}
\begin{DoxyCompactList}\small\item\em Current write position in circular log (0..LOG\+\_\+\+CAPACITY-\/1). \end{DoxyCompactList}\item 
uint32\+\_\+t \mbox{\hyperlink{group__log__flash_ga960039267784d0b901fd31737f74220d}{seq\+\_\+next}}
\begin{DoxyCompactList}\small\item\em Next sequential record number (increments on each append). \end{DoxyCompactList}\item 
\mbox{\hyperlink{group__log__flash_gaa8e473f8371172fa02b2ecf3bf4b2010}{Log\+Rec}}
\item 
os\+Message\+Queue\+Id\+\_\+t \mbox{\hyperlink{group__log__flash_gaa42f4a4e54ef104c44df1ce00a619e7a}{log\+Queue}}
\begin{DoxyCompactList}\small\item\em Global handle for the log message queue. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Public API for flash-\/based logging of system events and errors. 

Declares functions and data structures used by the flash logging system. See \doxylink{group__log__flash}{Log\+\_\+flash} for implementation details. 